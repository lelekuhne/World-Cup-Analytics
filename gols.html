<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>An√°lise de Gols - Copa do Mundo</title>
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-container">
      <a href="index.html" class="logo">Copa do Mundo Analytics</a>
      <nav>
        <a href="index.html">üè† In√≠cio</a>
        <a href="selecoes.html">üåé Sele√ß√µes</a>
        <a href="estadios.html">üèüÔ∏è Est√°dios</a>
        <a href="gols.html" class="active">‚öΩ Gols</a>
        <a href="recordes.html">‚≠ê Recordes</a>
        <a href="analises.html">üéØ An√°lises</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <div class="container">
      <!-- SECTION HEADER -->
      <div class="section-header">
        <h1>‚öΩ An√°lise de Gols</h1>
        <p>Estat√≠sticas completas sobre gols, m√©dias e maiores partidas da hist√≥ria da Copa</p>
      </div>

      <!-- CHARTS GRID -->
      <div class="grid full">
        <div class="card">
          <h3>M√©dia de Gols por Jogo por Edi√ß√£o</h3>
          <div class="chart-container" id="chart-goals-per-edition"></div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Partidas com Mais Gols</h3>
          <div class="chart-container" id="chart-top-matches"></div>
        </div>
        <div class="card">
          <h3>Distribui√ß√£o de Gols por Fase</h3>
          <div class="chart-container" id="chart-goals-by-phase"></div>
        </div>
      </div>

      <!-- TABLE -->
      <div class="card full">
        <h3>üìä Detalhes das Partidas</h3>
        <div class="table-wrap" id="table-gols"></div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>‚öΩ Copa do Mundo Analytics - An√°lise Hist√≥rica Completa</p>
    <p class="small">Dados atualizados at√© a Copa do Mundo 2022</p>
  </footer>

  <script src="dados.js"></script>
  <script>
    function plotGoalsPerEdition() {
      const byYear = {};
      DATA.forEach(r => {
        const y = r["Ano"];
        const g = Number(r["Placar A"] || 0) + Number(r["Placar B"] || 0);
        byYear[y] = (byYear[y] || { goals: 0, games: 0 });
        byYear[y].goals += g;
        byYear[y].games += 1;
      });
      const xs = Object.keys(byYear).sort((a, b) => a - b);
      const ys = xs.map(x => (byYear[x].games ? (byYear[x].goals / byYear[x].games) : 0).toFixed(2));

      Plotly.newPlot('chart-goals-per-edition', [{
        x: xs,
        y: ys,
        type: 'bar',
        marker: { color: '#3b82f6' },
        name: 'M√©dia de Gols'
      }, {
        x: xs,
        y: ys,
        type: 'scatter',
        mode: 'lines',
        name: 'Tend√™ncia',
        line: { color: '#ef4444', dash: 'dash', width: 2 }
      }], {
        title: { text: '', font: { size: 16 } },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#f1f5f9' },
        xaxis: { title: 'Ano', gridcolor: '#334155' },
        yaxis: { title: 'M√©dia de Gols', gridcolor: '#334155' },
        hovermode: 'x unified',
        showlegend: true
      });
    }

    function topMatchesByGoals() {
      const arr = DATA.map(r => ({
        ...r,
        total: (Number(r["Placar A"] || 0) + Number(r["Placar B"] || 0))
      })).sort((a, b) => b.total - a.total).slice(0, 15);

      Plotly.newPlot('chart-top-matches', [{
        x: arr.map(a => a.total),
        y: arr.map(a => `${a["Time A"]} ${a["Placar A"]}x${a["Placar B"]} ${a["Time B"]} (${a["Ano"]})`),
        type: 'bar',
        orientation: 'h',
        marker: { color: '#10b981' }
      }], {
        title: { text: '', font: { size: 16 } },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#f1f5f9' },
        xaxis: { title: 'Total de Gols', gridcolor: '#334155' },
        hovermode: 'y unified'
      });
    }

    function goalsByPhase() {
      const byP = {};
      DATA.forEach(r => byP[r["Fase"]] = (byP[r["Fase"]] || 0) + Number(r["Placar A"] || 0) + Number(r["Placar B"] || 0));
      const phaseOrder = ["Final", "Decisao do Terceiro Lugar", "Semifinais", "Quartas-de-final", "Oitavas-de-final", "Segunda Fase", "Fase de Grupos", "Primeira Fase", "Grupo 1", "Grupo 2", "Grupo 3", "Grupo 4", "Grupo 5", "Grupo 6", "Grupo A", "Grupo B", "Grupo C", "Grupo D", "Grupo E", "Grupo F", "Grupo G", "Grupo H"];
      const arr = Object.entries(byP).sort((a, b) => phaseOrder.indexOf(a[0]) - phaseOrder.indexOf(b[0]));

      Plotly.newPlot('chart-goals-by-phase', [{
        x: arr.map(a => a[0]),
        y: arr.map(a => a[1]),
        type: 'bar',
        marker: { color: '#f59e0b' }
      }], {
        title: { text: '', font: { size: 16 } },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#f1f5f9' },
        xaxis: { title: 'Fase', tickangle: -45, gridcolor: '#334155' },
        yaxis: { title: 'Total de Gols', gridcolor: '#334155' },
        hovermode: 'x unified'
      });
    }

    function tableGols() {
      const rows = DATA.slice(0, 200);
      let html = '<table><thead><tr><th>Ano</th><th>Fase</th><th>Time A</th><th>Placar</th><th>Time B</th><th>Est√°dio</th></tr></thead><tbody>';
      rows.forEach(r => {
        html += `<tr><td>${r["Ano"]}</td><td>${r["Fase"]}</td><td>${r["Time A"]}</td><td><strong>${r["Placar A"]} x ${r["Placar B"]}</strong></td><td>${r["Time B"]}</td><td>${r["Estadio"]}</td></tr>`;
      });
      html += '</tbody></table>';
      document.getElementById('table-gols').innerHTML = html;
    }

    plotGoalsPerEdition();
    topMatchesByGoals();
    goalsByPhase();
    tableGols();
  </script>
</body>
</html>

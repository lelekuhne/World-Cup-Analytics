<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SeleÃ§Ãµes - Copa do Mundo</title>
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- HEADER -->
   <header>
    <div class="header-container">
      <a href="index.html" class="logo">Copa do Mundo Analytics</a>
      <nav>
        <a href="index.html">ğŸ  InÃ­cio</a>
        <a href="selecoes.html" class="active">ğŸŒ SeleÃ§Ãµes</a>
        <a href="estadios.html">ğŸŸï¸ EstÃ¡dios</a>
        <a href="gols.html">âš½ Gols</a>
        <a href="recordes.html">â­ Recordes</a>
        <a href="analises.html">ğŸ¯ AnÃ¡lises</a>
      </nav>
    </div>
  </header>

  <!-- MAIN CONTENT -->
  <main>
    <div class="container">
      <!-- SECTION HEADER -->
      <div class="section-header">
        <h1>ğŸŒ AnÃ¡lises por SeleÃ§Ã£o</h1>
        <p>Desempenho histÃ³rico de cada seleÃ§Ã£o na Copa do Mundo</p>
      </div>

      <!-- FILTER SECTION -->
      <div class="filter-section">
        <div class="filter-group">
          <label for="sel-team-filter">Escolha uma SeleÃ§Ã£o</label>
          <select id="sel-team-filter"></select>
        </div>
      </div>

      <!-- CHARTS GRID -->
      <div class="grid full">
        <div class="card">
          <h3>Top SeleÃ§Ãµes por VitÃ³rias</h3>
          <div class="chart-container" id="chart-team-topwins"></div>
        </div>
      </div>

      <div class="grid full">
        <div class="card">
          <h3>Desempenho por Fase e EdiÃ§Ã£o</h3>
          <div class="chart-container" id="chart-team-heatmap"></div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>ğŸ† Maior Goleada</h3>
          <div id="maior-goleada-team" class="text-gold" style="font-size: 1.2rem; margin-top: 1rem;">â€“</div>
        </div>
        <div class="card">
          <h3>ğŸ’” Maior Derrota</h3>
          <div id="suffered" class="text-gold" style="font-size: 1.2rem; margin-top: 1rem;">â€“</div>
        </div>
      </div>

      <!-- STATS CARD -->
      <div class="card full">
        <h3>ğŸ“Š EstatÃ­sticas da SeleÃ§Ã£o</h3>
        <div id="team-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;"></div>
      </div>

      <!-- TABLE -->
      <div class="card full">
        <h3>ğŸ“‹ HistÃ³rico de Jogos</h3>
        <div class="table-wrap" id="table-selecao"></div>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>âš½ Copa do Mundo Analytics - AnÃ¡lise HistÃ³rica Completa</p>
    <p class="small">Dados atualizados atÃ© a Copa do Mundo 2022</p>
  </footer>

  <script src="dados.js"></script>
  <script>
    const teams = unique(DATA.flatMap(d => [d["Time A"], d["Time B"]])).sort();
    const sel = document.getElementById('sel-team-filter');
    const optAll = document.createElement('option');
    optAll.value = 'all';
    optAll.text = 'Todas as SeleÃ§Ãµes';
    sel.appendChild(optAll);
    teams.forEach(t => {
      const o = document.createElement('option');
      o.value = t;
      o.text = t;
      sel.appendChild(o);
    });

    function plotTopWins(filtered) {
      const wins = {};
      filtered.forEach(r => {
        const a = r["Time A"], b = r["Time B"];
        const pa = Number(r["Placar A"] || 0), pb = Number(r["Placar B"] || 0);
        if (pa > pb) wins[a] = (wins[a] || 0) + 1;
        else if (pb > pa) wins[b] = (wins[b] || 0) + 1;
      });
      const arr = Object.entries(wins).map(([k, v]) => ({ team: k, wins: v })).sort((a, b) => b.wins - a.wins).slice(0, 15);

      Plotly.newPlot('chart-team-topwins', [{
        x: arr.map(a => a.team),
        y: arr.map(a => a.wins),
        type: 'bar',
        marker: { color: '#3b82f6' }
      }], {
        title: { text: '', font: { size: 16 } },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#f1f5f9' },
        xaxis: { title: 'SeleÃ§Ã£o', tickangle: -45, gridcolor: '#334155' },
        yaxis: { title: 'VitÃ³rias', gridcolor: '#334155' },
        hovermode: 'x unified'
      });
    }

    function plotTeamHeatmap(team) {
      if (!team || team === 'all') {
        Plotly.purge('chart-team-heatmap');
        return;
      }

      const years = unique(DATA.map(d => d["Ano"])).sort((a, b) => a - b);
      const phases = ["Primeira Fase", "Fase de Grupos", "Segunda Fase", "Oitavas-de-final", "Quartas-de-final", "Semifinais", "Decisao do Terceiro Lugar", "Final"];
      const z = [];

      years.forEach(year => {
        const row = [];
        phases.forEach(phase => {
          const match = DATA.find(r => r["Ano"] === year && r["Fase"] === phase && (r["Time A"] === team || r["Time B"] === team));
          let value = 0;

          if (match) {
            const pa = Number(match["Placar A"] || 0);
            const pb = Number(match["Placar B"] || 0);
            const isTeamA = match["Time A"] === team;

            if (pa === pb) {
              value = 2;
            } else if ((isTeamA && pa > pb) || (!isTeamA && pb > pa)) {
              value = 3;
            } else {
              value = 1;
            }
          }
          row.push(value);
        });
        z.push(row);
      });

      Plotly.newPlot('chart-team-heatmap', [{
        z: z,
        x: phases,
        y: years,
        type: 'heatmap',
        colorscale: [
          [0, 'rgb(30, 30, 30)'],
          [0.33, 'rgb(239, 68, 68)'],
          [0.66, 'rgb(255, 255, 191)'],
          [1, 'rgb(16, 185, 129)']
        ],
        hoverongaps: false,
        showscale: false
      }], {
        title: { text: `Desempenho de ${team}`, font: { size: 16 } },
        paper_bgcolor: 'rgba(0,0,0,0)',
        plot_bgcolor: 'rgba(0,0,0,0)',
        font: { color: '#f1f5f9' },
        xaxis: { title: 'Fase', tickangle: -45 },
        yaxis: { title: 'Ano' }
      });
    }

    function maiorGoleadaDoTime(team) {
      if (!team || team === 'all') {
        document.getElementById('maior-goleada-team').innerText = 'Selecione uma seleÃ§Ã£o';
        return;
      }

      const jogos = DATA.filter(r => r["Time A"] === team || r["Time B"] === team);
      let best = null;
      let diff = 0;

      jogos.forEach(r => {
        const pa = Number(r["Placar A"] || 0);
        const pb = Number(r["Placar B"] || 0);
        const a = r["Time A"];
        const b = r["Time B"];

        if (a === team && pa > pb) {
          const d = pa - pb;
          if (d > diff) { diff = d; best = r; }
        } else if (b === team && pb > pa) {
          const d = pb - pa;
          if (d > diff) { diff = d; best = r; }
        }
      });

      const el = document.getElementById('maior-goleada-team');
      if (best)
        el.innerText = `${best["Time A"]} ${best["Placar A"]} Ã— ${best["Placar B"]} ${best["Time B"]} (${best["Ano"]})`;
      else
        el.innerText = 'Nenhuma vitÃ³ria encontrada';
    }

    function teamStats(team) {
      if (!team || team === 'all') {
        document.getElementById('team-stats').innerHTML = '<div class="small">Escolha uma seleÃ§Ã£o para estatÃ­sticas</div>';
        return;
      }

      let games = 0, wins = 0, draws = 0, losses = 0, forg = 0, against = 0;
      DATA.forEach(r => {
        const a = r["Time A"], b = r["Time B"];
        const pa = Number(r["Placar A"] || 0), pb = Number(r["Placar B"] || 0);
        if (a === team || b === team) {
          games++;
          const gf = (a === team) ? pa : pb;
          const ga = (a === team) ? pb : pa;
          forg += gf;
          against += ga;
          if (gf > ga) wins++;
          else if (gf === ga) draws++;
          else losses++;
        }
      });

      document.getElementById('team-stats').innerHTML = `
        <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #3b82f6;">
          <div class="small">Jogos: <strong>${games}</strong></div>
        </div>
        <div style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #10b981;">
          <div class="small">VitÃ³rias: <strong>${wins}</strong></div>
        </div>
        <div style="background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #fbbf24;">
          <div class="small">Empates: <strong>${draws}</strong></div>
        </div>
        <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #ef4444;">
          <div class="small">Derrotas: <strong>${losses}</strong></div>
        </div>
        <div style="background: rgba(34, 211, 238, 0.1); padding: 1rem; border-radius: 8px; border-left: 4px solid #22d3ee;">
          <div class="small">Gols: <strong>${forg}</strong> marcados Â· <strong>${against}</strong> sofridos</div>
        </div>
      `;
    }

    function maiorGoleadaSofrida(team) {
      if (!team || team === 'all') {
        const el = document.getElementById('suffered');
        if (el) el.innerText = 'Selecione uma seleÃ§Ã£o';
        return;
      }

      const perdas = DATA.filter(r => {
        const pa = Number(r["Placar A"] || 0), pb = Number(r["Placar B"] || 0);
        if (r["Time A"] === team && pa < pb) return true;
        if (r["Time B"] === team && pb < pa) return true;
        return false;
      });

      if (perdas.length === 0) {
        const el = document.getElementById('suffered');
        if (el) el.innerText = 'Nenhuma derrota encontrada';
        return;
      }

      let best = null;
      let maxDiff = -1;
      perdas.forEach(r => {
        const pa = Number(r["Placar A"] || 0), pb = Number(r["Placar B"] || 0);
        let diff = 0;
        if (r["Time A"] === team) diff = pb - pa;
        else diff = pa - pb;
        if (diff > maxDiff) { maxDiff = diff; best = r; }
      });

      const el = document.getElementById('suffered');
      if (!el) return;
      if (best) {
        const pa = Number(best["Placar A"] || 0), pb = Number(best["Placar B"] || 0);
        const winner = pa > pb ? best["Time A"] : best["Time B"];
        const winnerScore = Math.max(pa, pb);
        const loser = pa > pb ? best["Time B"] : best["Time A"];
        const loserScore = Math.min(pa, pb);
        el.innerText = `${winner} ${winnerScore} Ã— ${loserScore} ${loser} (${best["Ano"]})`;
      } else {
        el.innerText = 'Nenhuma derrota encontrada';
      }
    }

    function tableSelecao(team) {
      const table = DATA.filter(r => r["Time A"] === team || r["Time B"] === team).slice(0, 200);
      let html = '<table><thead><tr><th>Ano</th><th>Fase</th><th>Time A</th><th>Placar</th><th>Time B</th><th>EstÃ¡dio</th></tr></thead><tbody>';
      table.forEach(r => {
        html += `<tr><td>${r["Ano"]}</td><td>${r["Fase"]}</td><td>${r["Time A"]}</td><td><strong>${r["Placar A"]} x ${r["Placar B"]}</strong></td><td>${r["Time B"]}</td><td>${r["Estadio"]}</td></tr>`;
      });
      html += '</tbody></table>';
      document.getElementById('table-selecao').innerHTML = html;
    }

    function renderTeamPage() {
      const team = sel.value;
      plotTopWins(DATA);
      maiorGoleadaDoTime(team);
      teamStats(team);
      maiorGoleadaSofrida(team);
      plotTeamHeatmap(team);
      tableSelecao(team);
    }

    sel.addEventListener('change', () => renderTeamPage());
    plotTopWins(DATA);
  </script>
</body>
</html>
